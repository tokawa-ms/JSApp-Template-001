# 警察官向け会話監視デモアプリケーション仕様書

## 1. プロジェクト概要

### 1.1 目的

本アプリケーションは、警察官の業務を支援するための会話監視・分析ツールのデモンストレーション版です。リアルタイムで複数人の会話を文字起こしし、潜在的な犯罪リスクを自動検出・警告することで、警察官の状況判断を支援します。

### 1.2 対象ユーザー

- 警察官
- 警察署管理者
- セキュリティ担当者

### 1.3 技術的位置づけ

- フロントエンドのみの静的 Web アプリケーション
- ブラウザで直接実行可能
- Azure AI サービスとの連携

## 2. 機能要件

### 2.1 音声文字起こし機能

- **Azure Speech Service**を利用した高精度な音声認識
- 複数話者の同時認識対応
- リアルタイムストリーミング処理
- 多言語音声認識対応（英語・日本語）

#### 2.1.0 言語選択機能

- 音声認識対象言語の動的切り替え
- 対応言語: 英語（en-US）、日本語（ja-JP）
- デフォルト言語: 英語（en-US）
- 設定 UI でのリアルタイム言語変更

#### 2.1.1 ダイアライゼーション機能

- 複数の話者を自動識別
- 話者ごとに異なる色分け表示
- 話者ラベル（話者 1、話者 2...）の自動割り当て
- 話者変更時の視覚的な区切り表示

### 2.2 コンテンツ安全性分析機能

- **Azure Content Safety**による高精度なリスク判定
- 暴力表現、脅迫、違法行為に関する表現の検出
- リスクレベルの段階的評価（低・中・高）

#### 2.2.1 リスク検出の対象

- 暴力的表現（物理的暴力、威嚇）
- 脅迫・恐喝に関する表現
- 違法薬物に関する言及
- 犯罪計画に関する会話
- ハラスメント関連の表現

### 2.3 高リスク表現の視覚化機能

- **Azure OpenAI GPT-4o-mini**による詳細分析
- 高リスクと判定された部分の特定
- 該当テキストの赤色ハイライト表示
- ワンクリックでのリスク詳細表示

#### 2.3.1 ハイライト表示仕様

- 背景色: 赤色（#ff4444）
- テキスト色: 白色（#ffffff）
- 点滅効果による注意喚起
- ホバー時のツールチップ表示

#### 2.3.2 音声警告機能

- 高リスク検出時の自動音声アラート
- カスタマイズ可能な警告音ファイル
- 音量調整機能（0-100%）
- 警告音のオン・オフ切り替え
- 複数の警告音パターン選択機能

##### 2.3.2.1 警告音ファイル仕様

- 対応フォーマット: MP3, WAV, OGG
- 推奨音声長: 1-3 秒
- ファイルサイズ制限: 500KB 以下
- 格納場所: `src/assets/sounds/`ディレクトリ
- デフォルト警告音: `warning-alert.mp3`

##### 2.3.2.2 警告音パターン

- **緊急アラート**: 高音の連続ビープ音
- **注意喚起**: 中音のシングルビープ
- **カスタム**: ユーザー指定の音声ファイル
- **音声ガイダンス**: 「警告：危険な表現が検出されました」等の音声メッセージ

### 2.4 状況要約機能

- **Azure OpenAI GPT-4o-mini**による自動要約生成
- 会話の要点抽出
- リスクレベルの総合評価
- 推奨アクションの提案

#### 2.4.1 要約内容

- 会話参加者数
- 主要な話題
- 検出されたリスク要素
- 時系列での状況変化
- 警察官への推奨対応

## 3. 技術仕様

### 3.1 フロントエンド技術スタック

- **HTML5**: セマンティックマークアップによる構造化
- **Tailwind CSS**: レスポンシブデザインとユーティリティクラス
- **JavaScript ES6**: モダン JavaScript 機能の活用
- **Web Audio API**: 音声警告機能の実装
- **CDN 配信**: 外部依存の最小化

### 3.1.1 音声機能技術詳細

- **Audio 要素**: HTML5 Audio タグによる音声再生
- **音量制御**: JavaScript による動的音量調整
- **ファイル管理**: 静的アセットとしての音声ファイル管理
- **プリロード機能**: 警告音の事前読み込みによる高速再生

### 3.1.2 言語機能技術詳細

- **言語コード管理**: ISO 639-1 準拠の言語コード
- **動的言語切り替え**: Azure Speech API の言語パラメータ変更
- **UI 多言語化**: English 固定、言語選択 UI のみ多言語対応
- **設定保存**: sessionStorage による言語設定の保持

### 3.2 Azure AI サービス連携

- **Azure Speech Service**
  - Speech-to-Text API
  - Speaker Recognition API
  - 多言語対応（en-US, ja-JP）
  - リアルタイムストリーミング
- **Azure Content Safety**
  - Text Analysis API
  - 多言語コンテンツ分析
  - カスタム分類機能
- **Azure OpenAI Service**
  - GPT-4o-mini モデル
  - 多言語テキスト分析・要約生成

### 3.3 ブラウザ要件

- Chrome 90 以上
- Firefox 88 以上
- Edge 90 以上
- マイクアクセス許可必須

## 4. ユーザーインターフェース設計

### 4.1 メイン画面レイアウト

```
┌─────────────────────────────────────────────────────────┐
│                     Header                              │
│  [Voice Monitoring Demo - For Police Officers]          │
├─────────────────────────────────────────────────────────┤
│  API Configuration Panel                                │
│  [Speech API Key] [Content Safety Key] [OpenAI Key]     │
├─────────────────────────────────────────────────────────┤
│  Control Panel                                          │
│  [Start] [Stop] [Clear] [Generate Summary]              │
│  Language: [English/Japanese] Audio: [Warning ON/OFF] [Volume] [Sound] │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  Transcript Display Area                                │
│  (Speaker color-coding, risk areas highlighted in red)  │
│                                                         │
├─────────────────────────────────────────────────────────┤
│  Situation Summary Panel                                │
│  (AI-generated summary, risk assessment, recommended actions) │
└─────────────────────────────────────────────────────────┘
```

### 4.1.1 UI 表記言語仕様

- **表示言語**: 英語のみ
- **ボタン・ラベル**: 全て英語表記
- **メッセージ・通知**: 英語での表示
- **設定項目**: 英語でのオプション表示

### 4.2 カラーパレット

- **プライマリ**: #1e40af（警察ブルー）
- **セカンダリ**: #6b7280（グレー）
- **警告色**: #ef4444（赤）
- **成功色**: #10b981（緑）
- **背景色**: #f9fafb（ライトグレー）

### 4.3 レスポンシブデザイン

- デスクトップ: 1200px 以上
- タブレット: 768px - 1199px
- モバイル: 767px 以下

## 5. セキュリティ要件

### 5.1 API キー管理

- UI での動的入力方式
- セッションストレージでの一時保存
- ページリロード時の自動クリア

### 5.2 音声データ保護

- 音声データのローカル処理
- 外部サーバーへの永続保存禁止
- セッション終了時の自動削除

### 5.3 プライバシー保護

- 個人情報の自動マスキング
- 録音開始前の明示的同意
- データ処理の透明性確保

## 6. パフォーマンス要件

### 6.1 リアルタイム性能

- 音声認識レイテンシ: 2 秒以内
- リスク判定応答時間: 3 秒以内
- UI 更新頻度: 500ms 間隔

### 6.2 精度要件

- 音声認識精度: 90%以上
- 話者識別精度: 85%以上
- リスク検出精度: 95%以上

## 7. エラーハンドリング

### 7.1 ネットワークエラー

- Azure API 接続失敗時の再試行機能
- オフライン状態の検出と通知
- 段階的な機能縮退

### 7.2 音声入力エラー

- マイクアクセス拒否時の代替手段
- 音声品質低下時の警告表示
- ノイズ除去処理の自動適用

### 7.3 ユーザーエラー

- 不正な API キー入力時のガイダンス
- 必須項目未入力時の視覚的フィードバック
- 操作手順の段階的ガイド

## 8. テスト要件

### 8.1 機能テスト

- 各 Azure API との連携確認
- ブラウザ間の互換性テスト
- 異なる音声環境での動作確認

### 8.2 性能テスト

- 長時間連続使用時の安定性
- 複数話者同時発話時の処理能力
- メモリ使用量の監視

### 8.3 セキュリティテスト

- API キーの適切な保護確認
- XSS/CSRF 攻撃への耐性
- データ漏洩リスクの評価

## 9. 運用要件

### 9.1 デプロイメント

- 静的ファイルの直接配布
- CDN 経由での高速配信
- キャッシュ戦略の最適化

### 9.2 保守性

- モジュラー設計による保守容易性
- 詳細なログ出力機能
- 設定の外部化

### 9.3 拡張性

- 新しい言語への対応準備
- 追加 AI サービスとの連携基盤
- カスタム警告ルールの設定機能

## 10. 利用者ガイド

### 10.1 初期設定

1. Azure Speech Service API キーの取得と設定
2. Azure Content Safety API キーの取得と設定
3. Azure OpenAI Service API キーの取得と設定
4. マイクアクセス許可の設定

### 10.2 基本操作

1. API キーの入力
2. 音声認識言語の選択（英語・日本語、デフォルト：英語）
3. 音声警告設定の調整（オプション）
4. 「Start」ボタンでの監視開始
5. リアルタイムでの会話確認
6. 警告表示・音声アラートへの対応
7. 「Generate Summary」での状況把握

### 10.3 言語設定

- **音声認識言語**: English (en-US) / Japanese (ja-JP)
- **UI 表示言語**: English（固定）
- **デフォルト設定**: English
- **動的変更**: 監視中でも言語切り替え可能

### 10.4 音声警告設定

- 警告音のオン・オフ切り替え
- 音量レベル調整（0-100%）
- 警告音パターンの選択
- カスタム音声ファイルのアップロード
- 警告音のテスト再生機能

### 10.5 高度な使用方法

- カスタム警告しきい値の調整
- 話者識別精度の向上設定
- 要約生成パラメータの調整

## 11. 制限事項

### 11.1 技術的制限

- インターネット接続必須
- 最新ブラウザでの動作限定
- 同時処理可能話者数: 最大 10 名

### 11.2 利用制限

- デモ目的での使用に限定
- 実際の捜査での使用は別途検討必要
- 法的責任は利用者が負担

## 12. 今後の拡張計画

### 12.1 短期計画（3 ヶ月以内）

- 多言語対応の実装
- カスタマイズ可能な警告ルール
- 音声品質向上機能

### 12.2 中期計画（6 ヶ月以内）

- 感情分析機能の追加
- 自動レポート生成機能
- データベース連携機能

### 12.3 長期計画（1 年以内）

- 機械学習モデルのカスタマイズ
- リアルタイム翻訳機能
- モバイルアプリ版の開発
